# Implementation Plan: Unified Stakeholder System

**Branch**: `020-stakeholder` | **Date**: 2026-01-21 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/020-stakeholder/spec.md`

## Summary

Replace the existing dual Consultant/Contractor lists with a unified 4-group stakeholder taxonomy (Client, Authority, Consultant, Contractor). Implement AI-powered stakeholder generation using project Profile and Objectives context from the Profiler module (019). Provide group-appropriate workflows: tender process for Consultant/Contractor, submission status for Authority, simple contact management for Client.

## Technical Context

**Language/Version**: TypeScript 5.x
**Primary Dependencies**: Next.js 16, React 19, Drizzle ORM, Radix UI, TailwindCSS, Anthropic Claude SDK
**Storage**: SQLite (primary) / PostgreSQL (production) via Drizzle ORM
**Testing**: Jest with React Testing Library
**Target Platform**: Web application (browser)
**Project Type**: Web application (monorepo: frontend + API routes in Next.js)
**Performance Goals**: <2s load for 100 stakeholders, <500ms for tender status updates
**Constraints**: Must migrate existing consultant/contractor data without data loss
**Scale/Scope**: 50+ stakeholders per project, 4 groups, 5 user stories, 13 functional requirements

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Pre-Design | Post-Design | Notes |
|-----------|------------|-------------|-------|
| I. Intelligent Document Repository | N/A | N/A | Stakeholder module doesn't manage documents directly |
| II. Domain-First Intelligence | ✅ PASS | ✅ PASS | Uses construction terminology: disciplines, trades, authorities, Australian regulatory bodies |
| III. AI-Powered Automation | ✅ PASS | ✅ PASS | AI-powered stakeholder generation using `getRecommendedDisciplines()` from Profile context |
| IV. Financial Visibility Throughout Lifecycle | ✅ PASS | ✅ PASS | Award integration with Cost Plan via `companyId` FK and Cost Plan line linking |
| V. Small Firm Optimization | ✅ PASS | ✅ PASS | Single unified interface replaces 3 separate lists (stakeholders, consultants, contractors) |
| VI. Sharp, Actionable Outputs | ✅ PASS | ✅ PASS | Profile-driven generation with Australian-specific authorities and common trade packages |
| VII. Integration Over Isolation | ✅ PASS | ✅ PASS | Full integration with Profile (019), Cost Plan, Companies via typed service layer |
| VIII. Test-Driven Quality | ⏳ PENDING | ✅ PASS | Test checklist defined in quickstart.md: unit, integration, E2E tests specified |
| IX. Spreadsheet-Native UX | ⚠️ PARTIAL | ✅ PASS | Table-based UI with inline editing matches existing patterns; FortuneSheet not required for list management |

**Gate Status**: ✅ PASS (Post-Design) - All principles satisfied. No blocking violations.

## Project Structure

### Documentation (this feature)

```text
specs/020-stakeholder/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
│   └── stakeholders.yaml
└── tasks.md             # Phase 2 output (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
assemble.ai/
├── src/
│   ├── app/
│   │   └── api/
│   │       └── projects/
│   │           └── [projectId]/
│   │               └── stakeholders/          # NEW: Stakeholder API routes
│   │                   ├── route.ts           # GET/POST stakeholders
│   │                   ├── [stakeholderId]/
│   │                   │   └── route.ts       # GET/PUT/DELETE individual
│   │                   ├── generate/
│   │                   │   └── route.ts       # POST AI generation
│   │                   └── migrate/
│   │                       └── route.ts       # POST migration trigger
│   ├── components/
│   │   └── stakeholders/                      # NEW: Stakeholder UI components
│   │       ├── StakeholderSection.tsx         # Main section container (two-panel)
│   │       ├── StakeholderGroupNav.tsx        # Left nav with group counts (team size)
│   │       ├── StakeholderGroupSection.tsx    # Collapsible group section
│   │       ├── StakeholderTable.tsx           # Group-specific table
│   │       ├── StakeholderRow.tsx             # Table row with inline edit
│   │       ├── TenderProgressBar.tsx          # 4-stage tender indicator
│   │       ├── SubmissionStatusBadge.tsx      # Authority approval status
│   │       └── GenerateStakeholdersDialog.tsx # AI generation modal
│   └── lib/
│       ├── db/
│       │   ├── schema.ts                      # MODIFY: Add stakeholder tables
│       │   └── pg-schema.ts                   # MODIFY: Add stakeholder tables
│       ├── services/
│       │   ├── stakeholder-service.ts         # NEW: Business logic
│       │   └── stakeholder-generation.ts      # NEW: AI generation logic
│       └── utils/
│           └── stakeholder-migration.ts       # NEW: Data migration utility
└── tests/
    └── stakeholders/                          # NEW: Stakeholder tests
        ├── stakeholder-service.test.ts
        ├── stakeholder-migration.test.ts
        └── stakeholder-generation.test.ts
```

**Structure Decision**: Web application structure using Next.js App Router with API routes. New files follow existing patterns (see `src/components/dashboard/planning/` for similar section structure).

## Complexity Tracking

> No complexity violations identified. Feature uses existing patterns and integrates with established modules.

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| N/A | N/A | N/A |
